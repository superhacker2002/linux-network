
  

## Part 1. Инструмент ****ipcalc****

****== Задание ==****
##### Поднять виртуальную машину (далее -- ws1)
##### Установлена Ubuntu Server версии 20.04
![Установлена виртуалка](screenshots/vm.png)
  
#### 1.1. Сети и маски
##### Определить и записать в отчёт:

##### 1) адрес сети  __192.167.38.54/13__:

######  `192.160.0.0`

![Адрес сети](screenshots/net_address.png)

  

##### 2.1) перевод маски __255.255.255.0__ в префиксную и двоичную запись:

###### Префиксная: `/24`

###### Двоичная `11111111.11111111.11111111.00000000`

![Перевод маски](screenshots/netmask.png)

  

##### 2.2) __/15__ в обычную и двоичную

###### Обычная: `255.254.0.0`

###### Двоичная `11111111.11111110.00000000.00000000`

![Перевод маски](screenshots/prefix_mask.png)

##### 2.3) __11111111.11111111.11111111.11110000__ в обычную и префиксную

ipcalc не умеет переводить из бинарной записи в обычную, поэтому считаем самостоятельно

###### Обычная: `255.255.255.240`

###### Префиксная: `/28`

##### 3) минимальный и максимальный хост в сети __12.167.38.4__ при масках:

- ##### __/8__:

![Хосты /8](screenshots/hostsprefix.png)

- ##### __11111111.11111111.00000000.00000000__:

![Хосты бинарная маска](screenshots/hostsbin.png)

- ##### __255.255.254.0__:

![Хосты обычная запись](screenshots/hostsnormal.png)

- ##### __/4__:

![Хосты /4](screenshots/hostsprefix4.png)

#### 1.2. localhost

##### Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP:  _194.34.23.100_,  _127.0.0.2_,  _127.1.0.1_,  _128.0.0.1_

###### Сначала узнаем минимальный и максимальный хосты, которые могут работать на localhost
![Localhost](screenshots/localhost_ipcalc.png)
Зная host range мы можем сказать, что к адресам _127.0.0.2_,  _127.1.0.1_ мы `сможем обратиться`, а к _128.0.0.1_, _194.34.23.100_ - нет

#### 1.3. Диапазоны и сегменты сетей

##### Определить и записать в отчёт:

##### 1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных:  _10.0.0.45_,  _134.43.0.2_,  _192.168.4.2_,  _172.20.250.4_,  _172.0.2.1_,  _192.172.0.1_,  _172.68.0.2_,  _172.16.255.255_,  _10.10.10.10_,  _192.169.168.1_

Диапазоны частных адресов: 
1.  10.0.0.0/8 (всё что начинается на 10.);
2.  172.16.0.0/12 (с 172.16.0.0 по 172.31.255.255 включительно);
3.  192.168.0.0/16 (с 192.168.0.0 по 192.168.255.255 включительно).

##### `Частные адреса:` _10.0.0.45_, _10.10.10.10_, _192.168.4.2_, _172.20.250.4_ , _172.16.255.255_ , _10.10.10.10_
##### `Публичные адреса:` _134.43.0.2_ , _172.0.2.1_ , _192.172.0.1_ , _172.68.0.2_ , _192.169.168.1_

##### 2) какие из перечисленных IP адресов шлюза возможны у сети _10.10.0.0/18_: _10.0.0.1_, _10.10.0.2_, _10.10.10.10_, _10.10.100.1_, _10.10.1.255_

###### Узнаем минимальный и максимальный хосты для сети:
![Gateway hosts](screenshots/hosts_gateway.png)

Возможны адреса, которые находятся в этом диапазоне, т. е.: _10.10.0.2_, _10.10.10.10_

## Part 2. Статическая маршрутизация между двумя машинами
**== Задание ==**

##### 1) Поднять две виртуальные машины (далее -- ws1 и ws2)
###### Устанавливаем второй Ubuntu Server
![Вторая виртуальная машина](screenshots/second_vm.png)

##### 2) С помощью команды `ip a` посмотреть существующие сетевые интерфейсы
###### ws1:
![Сетевые интерфейсы ws1](screenshots/net_iface_ws1.png)

###### ws2:
![Сетевые интерфейсы ws2](screenshots/net_iface_ws2.png)

##### 3) Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - _192.168.100.10_, маска _/16_, ws2 - _172.24.116.8_, маска _/12_
###### Изменяем `etc/netplan/00-installer-config.yaml` для
###### ws1:
![Изменение ip адреса ws1](screenshots/changed_ip_ws1.png)

###### ws2:
![Изменение ip адреса ws2](screenshots/changed_ip_ws2.png)

###### Выполняем команду `netplan apply` для
###### ws1:
![netplan apply для ws1](screenshots/netplan_ws1.png)

###### ws2:
![netplan apply для ws2](screenshots/netplan_ws2.png)

#### 2.1. Добавление статического маршрута вручную

##### Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида  `ip r add`  и пропинговать соединение между машинами для
###### ws1:
![Добавление статического маршрута в ws1](screenshots/static_route_ws1.png)

###### ws2:
![Добавление статического маршрута в ws2](screenshots/static_route_ws2.png)

#### 2.2. Добавление статического маршрута с сохранением

##### 1) Перезапустить машины
###### Делаем reboot обеих машин

##### 2) Добавить статический маршрут от одной машины до другой с помощью файла  _etc/netplan/00-installer-config.yaml_ для 
###### ws1:
![Добавление статического маршрута с сохранением в ws1](screenshots/route_saved_ws1.png)

###### ws2:
![Добавление статического маршрута с сохранением в ws2](screenshots/route_saved_ws2.png)

##### 3) Пропинговать соединение между машинами
###### ws1:
![Пинг ws2](screenshots/ping_ws1.png)

###### ws2:
![Пинг ws1](screenshots/ping_ws2.png)

## Part 3. Утилита **iperf3**
#### 3.1. Скорость соединения
##### Перевести и записать в отчёт: 
8 Mbps = 1 MB/s  
100 MB/s = 819200 Kbps  
1 Gbps = 1024 Mbps  

#### 3.2. Утилита  **iperf3**
##### Измерить скорость соединения между ws1 и ws2
###### ws1 используем как сервер, запускаем на ней команду `iperf3 -s` 
![Запуск iperf3 на ws1(сервере)](screenshots/iperf_server.png)

###### ws2 используем как клиент, запускаем на ней команду `iperf3 -c 192.168.100.10` 
![Запуск iperf3 на ws2(клиенте)](screenshots/iperf_client.png)

## Part 4. Сетевой экран

#### 4.1. Утилита  **iptables**

##### Создать файл  _/etc/firewall.sh_, имитирующий фаерволл, на 
###### ws1:
![Firewall скрипт ws1](screenshots/iptables_ws1.png)

###### ws2:
![Firewall скрипт ws2](screenshots/iptables_ws2.png)

##### Запустить файлы на обеих машинах командами `chmod +x /etc/firewall.sh` и `/etc/firewall.sh` 

###### ws1:
![Запуск firewall скрипта ws1](screenshots/firewall_start_ws1.png)

###### ws2:
![Запуск firewall скрипта ws2](screenshots/firewall_start_ws2.png)

После запуска скрипта мы видим, что машина ws2, в отличие от ws1, не получает никаких сообщений от ws1 при ping

![Ping ws1 c ws2](screenshots/fw_ping_ws2.png)

Cоответственно, echo reply на ws1 остался заблокирован, хотя последним правилом в ее списке iptables было правило accept. 
![Последнее правило в таблице I-tables ws1](screenshots/last_rule_ws1.png)
Из этого можно сделать вывод, что более приоритетным правилом в конфигурации iptables будет первое правило, а противоречащие ему правила учитываться не будут.

#### 4.2. Утилита  **nmap**

##### Командой  **ping**  найти машину, которая не "пингуется", после чего утилитой  **nmap**  показать, что хост машины запущен
###### На предыдущем пункте мы уже поняли, что не пингуется ws1, с ws2 можно установить соеднинение:
![Ping ws2 с ws1 после настройки firewall](screenshots/success_ping_ws2.png)

###### Поверяем при помощи map, что машина запущена:
![nmap ws1](screenshots/nmap_ws1.png)


